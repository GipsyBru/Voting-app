<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Activity Ideas & Voting</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f5f5f5;
    padding: 24px;
  }
  .container {
    max-width: 800px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
  }
  input, textarea, button {
    font-size: 16px;
    padding: 8px;
  }
  button { cursor: pointer; }
  .hidden { display: none; }
  .add { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 8px; vertical-align: top; }
  th { background: #eee; }
</style>
</head>
<body>

<div class="container">

  <!-- HOME SCREEN -->
  <div id="homeScreen">
    <h1>Idea & Voting Spaces</h1>

    <h3>Create a new space</h3>
    <input id="newSpaceName" placeholder="Space name" /><br><br>
    <input id="newSpacePassword" placeholder="Password" type="password" /><br><br>
    <button onclick="createSpace()">Create space</button>

    <hr style="margin:30px 0;">

    <h3>Open existing space</h3>
    <input
      id="openSpaceName"
      placeholder="Start typing space name"
      list="spaceSuggestions"
      oninput="checkMatchingSpaces()"
    />
    <datalist id="spaceSuggestions"></datalist>
    <br><br>
    <input id="openSpacePassword" placeholder="Password" type="password" /><br><br>
    <button onclick="openSpace()">Open space</button>

    <p id="noMatchMsg" style="color:#888;"></p>
    <p id="homeMsg" style="color:red;"></p>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp" class="hidden">

    <button onclick="goHome()">üè† Home</button>

    <div style="font-size:14px; color:#555; margin-top:10px;">
      <span id="spaceName"></span>
    </div>

    <h1 style="text-align:center;">Activity Ideas & Voting</h1>

    <div class="add">
      <input id="nameInput" placeholder="Your name" />
      <input id="titleInput" placeholder="Activity title" />
      <textarea id="detailsInput" rows="2" placeholder="Activity details"></textarea>
      <button onclick="addIdea()">Add Idea</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Title</th>
          <th>Details</th>
          <th>Votes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ideasTable"></tbody>
    </table>
  </div>

</div>

<script>
let spaces = JSON.parse(localStorage.getItem("spaces") || "{}");
let currentSpace = null;

/* ---- Ensure existing space ---- */
if (!spaces["Islandsbryggeskole BH-Z 2026"]) {
  spaces["Islandsbryggeskole BH-Z 2026"] = {
    password: "1234",
    ideas: []
  };
  saveSpaces();
}

/* ---- Utilities ---- */
function saveSpaces() {
  localStorage.setItem("spaces", JSON.stringify(spaces));
}

function show(screen) {
  homeScreen.classList.add("hidden");
  mainApp.classList.add("hidden");
  document.getElementById(screen).classList.remove("hidden");
}

/* ---- Autocomplete ---- */
function updateSpaceSuggestions() {
  const datalist = document.getElementById("spaceSuggestions");
  datalist.innerHTML = "";

  Object.keys(spaces).sort().forEach(name => {
    const option = document.createElement("option");
    option.value = name;
    datalist.appendChild(option);
  });
}

function checkMatchingSpaces() {
  const input = openSpaceName.value.toLowerCase();
  const matches = Object.keys(spaces).filter(name =>
    name.toLowerCase().includes(input)
  );

  if (input && matches.length === 0) {
    noMatchMsg.textContent = "No matching spaces";
  } else {
    noMatchMsg.textContent = "";
  }
}

/* ---- Create space ---- */
function createSpace() {
  const name = newSpaceName.value.trim();
  const password = newSpacePassword.value.trim();
  if (!name || !password) return;

  if (spaces[name]) {
    homeMsg.textContent = "Space already exists.";
    return;
  }

  spaces[name] = { password, ideas: [] };
  saveSpaces();
  updateSpaceSuggestions();
  openSpace(name, password);
}

/* ---- Open space ---- */
function openSpace(nameParam, passParam) {
  const name = nameParam || openSpaceName.value.trim();
  const password = passParam || openSpacePassword.value.trim();

  const space = spaces[name];
  if (!space || space.password !== password) {
    homeMsg.textContent = "Incorrect space name or password.";
    return;
  }

  currentSpace = name;
  spaceName.textContent = name;
  homeMsg.textContent = "";
  openSpaceName.value = "";
  openSpacePassword.value = "";
  show("mainApp");
  render();
}

/* ---- Home ---- */
function goHome() {
  currentSpace = null;
  show("homeScreen");
}

/* ---- Render ideas ---- */
function render() {
  const ideas = spaces[currentSpace].ideas;
  ideas.sort((a, b) => b.votes - a.votes);

  ideasTable.innerHTML = "";

  if (!ideas.length) {
    ideasTable.innerHTML =
      `<tr><td colspan="5" style="text-align:center;color:#555;">No ideas yet.</td></tr>`;
    return;
  }

  ideas.forEach(idea => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${idea.name}</td>
      <td>${idea.title}</td>
      <td>${idea.details}</td>
      <td><button onclick="vote(${idea.id})">üëç</button> ${idea.votes}</td>
      <td><button onclick="deleteIdea(${idea.id})">üóë</button></td>
    `;
    ideasTable.appendChild(tr);
  });
}

/* ---- Add idea ---- */
function addIdea() {
  const name = nameInput.value.trim();
  const title = titleInput.value.trim();
  const details = detailsInput.value.trim();
  if (!name || !title) return;

  spaces[currentSpace].ideas.push({
    id: Date.now(),
    name,
    title,
    details,
    votes: 0
  });

  nameInput.value = titleInput.value = detailsInput.value = "";
  saveSpaces();
  render();
}

/* ---- Vote ---- */
function vote(id) {
  const idea = spaces[currentSpace].ideas.find(i => i.id === id);
  if (idea) {
    idea.votes++;
    saveSpaces();
    render();
  }
}

/* ---- Delete (password protected) ---- */
function deleteIdea(id) {
  const code = prompt("Enter space password:");
  if (code === spaces[currentSpace].password) {
    spaces[currentSpace].ideas =
      spaces[currentSpace].ideas.filter(i => i.id !== id);
    saveSpaces();
    render();
  } else {
    alert("Incorrect password.");
  }
}

/* ---- Init ---- */
updateSpaceSuggestions();
show("homeScreen");
</script>

</body>
</html>
